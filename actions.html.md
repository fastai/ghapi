# GitHub Actions details


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Workflow setup

In your GitHub Actions workflow, include the following in your `run`
step:

``` bash
env:
  CONTEXT_GITHUB: ${{ toJson(github) }}
```

This stores the full [github
context](https://docs.github.com/actions/reference/context-and-expression-syntax-for-github-actions#github-context),
which includes information such as the name of the current workflow
being run, the GitHub access token, and so forth.

As well as the `github` context, you can do that same thing for any of
the other GitHub Actions contexts, which are:

`github` `env` `job` `steps` `runner` `secrets` `strategy` `matrix`
`needs`

For instance, for the
[needs](https://docs.github.com/actions/reference/workflow-syntax-for-github-actions#jobsjob_idneeds)
context, information about previous jobs specified in your `needs`
clause, add this underneath your `CONTEXT_GITHUB` line:

``` bash
  CONTEXT_NEEDS: ${{ toJson(needs) }}
```

Note that here’s no harm having entries that are not used – GitHub
Actions will set them to an empty dictionary by default.

GitHub also adds a number of [`GITHUB_*` environment
variables](https://docs.github.com/actions/reference/environment-variables#default-environment-variables)
to all runners. These are available through the `env_github` `AttrDict`,
with the `GITHUB_` prefix removed, and remainder converted to lowercase.
For instance:

``` python
env_github.repository
```

    'octocat/Hello-World'

------------------------------------------------------------------------

<a
href="https://github.com/fastai/ghapi/blob/master/ghapi/actions.py#L37"
target="_blank" style="float:right; font-size:smaller">source</a>

### user_repo

>      user_repo ()

*List of `user,repo` from \`env_github.repository*

``` python
user_repo()
```

    ['octocat', 'Hello-World']

The possible events are available in the `Event` `enum`.

``` python
', '.join(Event)
```

    'page_build, content_reference, repository_import, create, workflow_run, delete, organization, sponsorship, project_column, push, context, milestone, project_card, project, package, pull_request, repository_dispatch, team_add, workflow_dispatch, member, meta, code_scanning_alert, public, needs, check_run, security_advisory, pull_request_review_comment, org_block, commit_comment, watch, marketplace_purchase, star, installation_repositories, check_suite, github_app_authorization, team, status, repository_vulnerability_alert, pull_request_review, label, installation, release, issues, repository, gollum, membership, deployment, deploy_key, issue_comment, ping, deployment_status, fork, schedule'

------------------------------------------------------------------------

<a
href="https://github.com/fastai/ghapi/blob/master/ghapi/actions.py#L59"
target="_blank" style="float:right; font-size:smaller">source</a>

### create_workflow_files

>      create_workflow_files (fname:str, workflow:str, build_script:str,
>                             prebuild:bool=False)

*Create workflow and script files in suitable places in `github` folder*

------------------------------------------------------------------------

<a
href="https://github.com/fastai/ghapi/blob/master/ghapi/actions.py#L71"
target="_blank" style="float:right; font-size:smaller">source</a>

### fill_workflow_templates

>      fill_workflow_templates (name:str, event, run, context, script,
>                               opersys='ubuntu', prebuild=False)

*Function to create a simple Ubuntu workflow that calls a Python
[`ghapi`](https://ghapi.fast.ai/cli.html#ghapi) script*

`event` is the event to trigger on. `run` is the shell lines to run
before running the script, such as a `pip install` step. `context` are
the env var context lines to include in the `env:` section of the
workflow, normally created with
[`env_contexts`](https://ghapi.fast.ai/actions.html#env_contexts).
`opersys` can be a string containing a comma-separated list of operating
systems, e.g. `macos, ubuntu, windows`, which will be used to create a
parallel matrix build.

The `prebuild` bool tells
[`ghapi`](https://ghapi.fast.ai/cli.html#ghapi) to include a prebuild
job, which contains the following workflow:

``` bash
runs-on: ubuntu-latest
outputs:
  out: ${{ toJson(steps) }}
steps:
- uses: actions/checkout@v1
- uses: actions/setup-python@v2
  with: {python-version: '3.8'}
- name: Create release
  id: step1
  env:
    CONTEXT_GITHUB: ${{ toJson(github) }}
  run: |
    pip install -q ghapi
    python .github/scripts/prebuild.py
```

------------------------------------------------------------------------

<a
href="https://github.com/fastai/ghapi/blob/master/ghapi/actions.py#L82"
target="_blank" style="float:right; font-size:smaller">source</a>

### env_contexts

>      env_contexts (contexts)

*Create a suitable `env:` line for a workflow to make a context
available in the environment*

------------------------------------------------------------------------

<a
href="https://github.com/fastai/ghapi/blob/master/ghapi/actions.py#L91"
target="_blank" style="float:right; font-size:smaller">source</a>

### create_workflow

>      create_workflow (name:str, event:fastcore.basics.Event,
>                       contexts:list=None, opersys='ubuntu', prebuild=False)

*Function to create a simple Ubuntu workflow that calls a Python
[`ghapi`](https://ghapi.fast.ai/cli.html#ghapi) script*

``` python
create_workflow('test', Event.release)
```

To create a basic [`ghapi`](https://ghapi.fast.ai/cli.html#ghapi)
workflow, call
[`create_workflow`](https://ghapi.fast.ai/actions.html#create_workflow),
passing in the event that you wish to respond to, and a name for your
workflow.

------------------------------------------------------------------------

<a
href="https://github.com/fastai/ghapi/blob/master/ghapi/actions.py#L99"
target="_blank" style="float:right; font-size:smaller">source</a>

### gh_create_workflow

>      gh_create_workflow (name:str, event:str, contexts:str='')

*Supports `gh-create-workflow`, a CLI wrapper for
[`create_workflow`](https://ghapi.fast.ai/actions.html#create_workflow).*

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>name</td>
<td>str</td>
<td></td>
<td>Name of the workflow file</td>
</tr>
<tr class="even">
<td>event</td>
<td>str</td>
<td></td>
<td>Event to listen for</td>
</tr>
<tr class="odd">
<td>contexts</td>
<td>str</td>
<td></td>
<td>Space-delimited extra contexts to include in <code>env</code> in
addition to github</td>
</tr>
</tbody>
</table>

## Accessing contexts from Python

The information from these variables are provided by `context_github`,
`context_needs`, and so forth for each named context. These variables
are `AttrDict` objects.

``` python
L(context_github)
```

    (#26) ['token','job','ref','sha','repository','repository_owner','repositoryUrl','run_id','run_number','retention_days'...]

``` python
context_github.ref
```

    'refs/heads/master'

If you use our recommended workflow template, you will have this
included in your prebuild step (if you have any):

``` bash
outputs:
  out: ${{ toJson(steps) }}
```

You can access this content as a dictionary like so:

``` python
loads(nested_idx(context_needs, "prebuild", "outputs", "out"))
```

    {'step1': {'outputs': {'tag': 'v0.79.0'},
      'outcome': 'success',
      'conclusion': 'success'}}

------------------------------------------------------------------------

<a
href="https://github.com/fastai/ghapi/blob/master/ghapi/actions.py#L111"
target="_blank" style="float:right; font-size:smaller">source</a>

### example_payload

>      example_payload (event)

*Get an example of a JSON payload for `event`*

## Workflow helper functions

------------------------------------------------------------------------

<a
href="https://github.com/fastai/ghapi/blob/master/ghapi/actions.py#L116"
target="_blank" style="float:right; font-size:smaller">source</a>

### github_token

>      github_token ()

*Get GitHub token from `GITHUB_TOKEN` env var if available, or from
`github` context*

------------------------------------------------------------------------

<a
href="https://github.com/fastai/ghapi/blob/master/ghapi/actions.py#L121"
target="_blank" style="float:right; font-size:smaller">source</a>

### actions_output

>      actions_output (name, value)

*Print the special GitHub Actions `::set-output` line for `name::value`*

Details in the [GitHub Documentation for
`set-output`](https://docs.github.com/actions/reference/workflow-commands-for-github-actions#setting-an-output-parameter).

------------------------------------------------------------------------

<a
href="https://github.com/fastai/ghapi/blob/master/ghapi/actions.py#L126"
target="_blank" style="float:right; font-size:smaller">source</a>

### actions_debug

>      actions_debug (message)

*Print the special `::debug` line for `message`*

Details in the [GitHub Documentation for
`debug`](https://docs.github.com/actions/reference/workflow-commands-for-github-actions#setting-a-debug-message).
Note that you must create a secret named `ACTIONS_STEP_DEBUG` with the
value true to see the debug messages set by this command in the log.

------------------------------------------------------------------------

<a
href="https://github.com/fastai/ghapi/blob/master/ghapi/actions.py#L131"
target="_blank" style="float:right; font-size:smaller">source</a>

### actions_warn

>      actions_warn (message, details='')

*Print the special `::warning` line for `message`*

Details in the [GitHub Documentation for
`warning`](https://docs.github.com/actions/reference/workflow-commands-for-github-actions#setting-a-warning-message).
For the optional `details`, you can provide comma-delimited file, line,
and column information, e.g.: `file=app.js,line=1,col=5`.

------------------------------------------------------------------------

<a
href="https://github.com/fastai/ghapi/blob/master/ghapi/actions.py#L136"
target="_blank" style="float:right; font-size:smaller">source</a>

### actions_error

>      actions_error (message, details='')

*Print the special `::error` line for `message`*

Details in the [GitHub Documentation for
`error`](https://docs.github.com/actions/reference/workflow-commands-for-github-actions#setting-an-error-message).
For the optional `details`, you can provide comma-delimited file, line,
and column information, e.g.: `file=app.js,line=1,col=5`.

------------------------------------------------------------------------

<a
href="https://github.com/fastai/ghapi/blob/master/ghapi/actions.py#L142"
target="_blank" style="float:right; font-size:smaller">source</a>

### actions_group

>      actions_group (title)

*Context manager to print the special `::group`/`::endgroup` lines for
`title`*

``` python
with actions_group('Adding numbers...'): print(1+1)
```

    ::group::Adding numbers...
    2
    ::endgroup::

Details in the GitHub Documentation for [grouping log
lines](https://docs.github.com/actions/reference/workflow-commands-for-github-actions#grouping-log-lines).

------------------------------------------------------------------------

<a
href="https://github.com/fastai/ghapi/blob/master/ghapi/actions.py#L149"
target="_blank" style="float:right; font-size:smaller">source</a>

### actions_mask

>      actions_mask (value)

*Print the special `::add-mask` line for `value`*

Details in the [GitHub Documentation for
`add-mask`](https://docs.github.com/actions/reference/workflow-commands-for-github-actions#masking-a-value-in-log).

------------------------------------------------------------------------

<a
href="https://github.com/fastai/ghapi/blob/master/ghapi/actions.py#L154"
target="_blank" style="float:right; font-size:smaller">source</a>

### set_git_user

>      set_git_user (api=None)

*Set git user name/email to authenticated user (if `api`) or GitHub
Actions bot (otherwise)*

When pushing to git from a workflow, you’ll need to set your username
and email address. You can set them to the
[`GhApi`](https://ghapi.fast.ai/core.html#ghapi) authenticated user’s
details by passing `api`. Otherwise, `github-actions[bot]` and
`github-actions[bot]@users.noreply.github.com` will be used, which will
make a push appear to be from “GitHub Actions”.
